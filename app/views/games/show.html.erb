<div class="container-fluid">

  <div class="row">
    <!--<div class="col-lg-1"></div>-->
    <div class="col-lg-4">

      <%= form_for @note, url: user_game_note_path(@user, @game), class: "form" do |f| %>

        <div class="form-group">
          <%= f.label(:note, "Notes") %>
          <%= f.text_area(:note, size: "30x25", class: "form-control") %>
        </div>
        <%= submit_tag("Save Note", class: "btn") %>
      <% end %>

    </div>


    <div class="col-lg-5">


      <div id="demo-container"></div>


      <div class="form-group">


        <%= form_tag(user_game_fen_path(@user, @game), method: :get) do %>
          <%= label_tag(:fen, "FEN for Move #") %>
          <%= number_field_tag(:fen) %>
          <!--<%= submit_tag("Find FEN", id: "fen-submit", class: "btn") %>-->
        <% end %>

      </div>

      <div class="fen-result"></div>


    </div>
    <!--<div class="col-lg-1"></div>-->

    <div class="col-lg-3">

      <div>
        <p>[Event "<%= @game[:event] %>"]</p>

        <p>[Date "<%= @game[:date] %>"]</p>

        <p>[White "<%= @game[:white] %>"]</p>

        <p>[Black "<%= @game[:black] %>"]</p>

        <p>[Result "<%= @game[:result] %>"]</p>
      </div>

      <div id="demo-moves"></div>
    </div>


  </div>
</div>


<!--<script type="text/javascript" src="http://chesstempo.com/js/pgnyui.js"></script>-->
<!--<script type="text/javascript"-->
<!--src="http://chesstempo.com/js/pgnviewer.js">-->
<!--</script>-->
<!--<script type="text/javascript" src="/chess-tempo/pgnviewer.js"></script>-->
<!--<link type="text/css" rel="stylesheet" href="http://chesstempo.com/css/board-min.css"/>-->

<script>

  $(document).ready(function () {

    buildViewer('<%= @game[:pgn] %>');
//
    var resetBorder = setTimeout(function (e) {//fixing border on board
      var demoBorder = $("#demo-boardBorder");
      demoBorder.css('width', '539px');
      demoBorder.css('height', '544px');
    }, 0);
//
//    $('#demo-container').on('click','#demo-flipper', function(){
//      debugger;
//
//      resetBorder();
//
//    });


    var fens = $.getJSON("<%= user_game_fen_path(@user,@game) %>");

//    console.log(fens)


    var fen_submit = $('#fen-submit');
//    console.log(fen_submit);


//    fen_submit.on('click', function (e) {
    $('#fen').on('input', function (e) {
//      e.preventDefault();
      var fenResult =  $('.fen-result');

      fenResult.empty();



      var fen_input = $('#fen');

      var move_num = fen_input.val();

//      console.log(fens.responseJSON[move_num][0]);


      fenResult.append("<p>" + move_num + ".   " + fens.responseJSON[move_num][0] + "</p>");
      fenResult.append("<p>" + move_num + "... " + fens.responseJSON[move_num][1] + "</p>");

//      $.each(fens.responseJSON, function (i, obj) {
////        console.log(i);
//        if (move_num == +i) {
//          $('.fen-result').empty();
//          $('.fen-result').append("<p>" + i + ".   " + obj[0] + "</p>");
//          $('.fen-result').append("<p>" + i + "... " + obj[1] + "</p>");
////          console.log(obj[0]);
//          return false; //break
//        }
//
//
//      });


    });


  });
</script>
